<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Magalh√£es Neg√≥cios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .version-badge {
            display: block;
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 30px;
            border: none;
            background: none;
            color: #666;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .label-subtitle {
            font-size: 12px;
            color: #666;
            font-weight: 400;
            margin-top: 2px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #667eea 0%, #764ba2 100%);
            outline: none;
        }

        .advanced-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .result-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .result-header {
            text-align: center;
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
        }

        .result-value {
            text-align: center;
            font-size: 42px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .imoveis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .imovel-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .imovel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .imovel-card.match-recomendado {
            border-left: 5px solid #28a745;
        }

        .imovel-card.match-possivel {
            border-left: 5px solid #ffc107;
        }

        .imovel-card.match-nao-recomendado {
            border-left: 5px solid #dc3545;
        }

        .match-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .badge-recomendado {
            background: #28a745;
            color: white;
        }

        .badge-possivel {
            background: #ffc107;
            color: #333;
        }

        .badge-nao-recomendado {
            background: #dc3545;
            color: white;
        }

        .construtora-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-tenda {
            background: #4A90E2;
            color: white;
        }

        .badge-mrv {
            background: #7ED321;
            color: white;
        }

        .badge-vasco {
            background: #F5A623;
            color: white;
        }

        .imovel-nome {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .imovel-preco {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        .imovel-info {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .info-tag {
            background: #f5f7fa;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
        }

        .entrada-detalhes {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }

        .entrada-detalhes h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .entrada-linha {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
        }

        .entrada-linha.destaque {
            font-weight: bold;
            border-top: 2px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .viabilidade-box {
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .viabilidade-recomendado {
            background: #d4edda;
            color: #155724;
        }

        .viabilidade-possivel {
            background: #fff3cd;
            color: #856404;
        }

        .viabilidade-nao-recomendado {
            background: #f8d7da;
            color: #721c24;
        }

        .imovel-obs {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            margin: 10px;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                padding: 12px 20px;
            }

            .imoveis-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                flex-direction: column;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .imoveis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† SISTEMA MAGALH√ÉES NEG√ìCIOS</h1>
        <span class="version-badge">v1.3.5 - Match Inteligente com Resumo Completo</span>

        <div class="tabs">
            <button class="tab active" onclick="showTab('qualificacao')">1Ô∏è‚É£ Qualifica√ß√£o Cliente</button>
            <button class="tab" onclick="showTab('configuracoes')">‚öôÔ∏è Configura√ß√µes</button>
            <button class="tab" onclick="showTab('imoveis')">2Ô∏è‚É£ Im√≥veis Compat√≠veis</button>
        </div>

        <!-- TAB 1: QUALIFICA√á√ÉO -->
        <div id="qualificacao" class="tab-content active">
            <div class="form-group">
                <label>Nome do Cliente:</label>
                <input type="text" id="nomeCliente" placeholder="Ex: Jo√£o da Silva">
            </div>

            <div class="form-group">
                <label>Renda Familiar Bruta:</label>
                <input type="number" id="renda" placeholder="Ex: 2350" step="100">
            </div>

            <div class="form-group">
                <label>Tipo de V√≠nculo:</label>
                <select id="vinculo">
                    <option value="clt">CLT (100%)</option>
                    <option value="autonomo">Aut√¥nomo (80%)</option>
                    <option value="aposentado">Aposentado (90%)</option>
                </select>
            </div>

            <div class="slider-container">
                <label>Valor de Avalia√ß√£o do Im√≥vel (Caixa):</label>
                <div class="slider-value" id="avaliacaoValor">R$ 244.000</div>
                <input type="range" id="avaliacao" min="100000" max="500000" value="244000" step="1000" oninput="updateAvaliacao()">
            </div>

            <div class="form-group">
                <label>FGTS Dispon√≠vel:</label>
                <input type="number" id="fgts" placeholder="Ex: 20000" step="1000" value="0">
            </div>

            <div class="form-group">
                <label>Tem Fator Social? (Mulher chefe de fam√≠lia, pessoa com defici√™ncia, etc)</label>
                <select id="fatorSocial">
                    <option value="sim">Sim</option>
                    <option value="nao">N√£o</option>
                </select>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="calcular()">üîç Calcular Capacidade e Ver Im√≥veis</button>
            </div>

            <div id="resultados" style="display: none;">
                <!-- Resultados aparecem aqui -->
            </div>
        </div>

        <!-- TAB CONFIGURA√á√ïES -->
        <div id="configuracoes" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">‚öôÔ∏è Configura√ß√µes Avan√ßadas</h2>

            <div class="alert-info">
                üí° Estas configura√ß√µes afetam os c√°lculos de viabilidade das construtoras. Ajuste conforme as condi√ß√µes atuais do mercado.
            </div>

            <div class="advanced-config">
                <h3 style="color: #4A90E2; margin-bottom: 15px;">üîµ TENDA</h3>
                <div class="form-group">
                    <label>Valor do ato obrigat√≥rio:</label>
                    <input type="number" id="configTendaAto" value="750" min="0" max="5000" step="50">
                    <div class="label-subtitle">Padr√£o: R$ 750</div>
                </div>
            </div>

            <div class="advanced-config">
                <h3 style="color: #7ED321; margin-bottom: 15px;">üü¢ MRV</h3>
                
                <div class="form-group">
                    <label>Taxa INCC mensal (%):</label>
                    <input type="number" id="configMrvIncc" value="0.35" min="0" max="2" step="0.05">
                    <div class="label-subtitle">Padr√£o: 0,35% ao m√™s (‚âà4,2% ao ano)</div>
                </div>
            </div>

            <div class="advanced-config">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìä CRIT√âRIOS DE MATCH</h3>
                
                <div class="form-group">
                    <label>Limite para RECOMENDADO (% da renda):</label>
                    <input type="number" id="configLimiteRecomendado" value="40" min="30" max="50" step="5">
                    <div class="label-subtitle">Padr√£o: 40% - Total mensal at√© este % = ‚úÖ RECOMENDADO</div>
                </div>

                <div class="form-group">
                    <label>Limite para POSS√çVEL (% da renda):</label>
                    <input type="number" id="configLimitePossivel" value="50" min="40" max="60" step="5">
                    <div class="label-subtitle">Padr√£o: 50% - Total mensal at√© este % = ‚ö†Ô∏è POSS√çVEL</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="salvarConfiguracoes()">üíæ Salvar Configura√ß√µes</button>
            </div>
        </div>

        <!-- TAB 2: IM√ìVEIS -->
        <div id="imoveis" class="tab-content">
            <div class="stats-bar" id="statsBar" style="display: none;">
                <div class="stat-item">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statRecomendado">0</div>
                    <div class="stat-label">‚úÖ Recomendado</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statPossivel">0</div>
                    <div class="stat-label">‚ö†Ô∏è Poss√≠vel</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statNaoRecomendado">0</div>
                    <div class="stat-label">‚ùå N√£o Recomendado</div>
                </div>
            </div>

            <div class="filters" id="filters" style="display: none;">
                <div class="filter-group">
                    <label>Construtora:</label>
                    <select id="filterConstrutora" onchange="aplicarFiltros()">
                        <option value="">Todas</option>
                        <option value="TENDA">TENDA</option>
                        <option value="MRV">MRV</option>
                        <option value="VASCO">VASCO</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Tipo:</label>
                    <select id="filterTipo" onchange="aplicarFiltros()">
                        <option value="">Todos</option>
                        <option value="Apartamento">Apartamento</option>
                        <option value="Casa">Casa</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Quartos:</label>
                    <select id="filterQuartos" onchange="aplicarFiltros()">
                        <option value="">Todos</option>
                        <option value="1">1 Quarto</option>
                        <option value="2">2 Quartos</option>
                        <option value="3">3 Quartos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Viabilidade:</label>
                    <select id="filterViabilidade" onchange="aplicarFiltros()">
                        <option value="">Todos</option>
                        <option value="recomendado">‚úÖ Recomendado</option>
                        <option value="possivel">‚ö†Ô∏è Poss√≠vel</option>
                        <option value="nao-recomendado">‚ùå N√£o Recomendado</option>
                    </select>
                </div>
            </div>

            <div id="imoveisLoading" class="loading">
                ‚è≥ Calcule a capacidade do cliente primeiro para ver os im√≥veis compat√≠veis...
            </div>

            <div id="imoveisGrid" class="imoveis-grid" style="display: none;">
                <!-- Im√≥veis aparecem aqui -->
            </div>
        </div>
    </div>

    <script>
        // DADOS GLOBAIS
        let capacidadeCliente = 0;
        let todosImoveis = [];
        let imoveisFiltrados = [];
        let dadosSimulacao = null;

        // CONFIGURA√á√ïES (podem ser ajustadas pelo usu√°rio)
        let config = {
            tenda: {
                ato_minimo: 750
            },
            mrv: {
                incc_mensal: 0.35
            },
            match: {
                limite_recomendado: 40,
                limite_possivel: 50
            }
        };

        // REGRAS DAS CONSTRUTORAS
        const REGRAS_CONSTRUTORAS = {
            VASCO: {
                percentual_max: 20,
                parcelas_max: 90,
                ato_minimo: 0
            },
            TENDA: {
                percentual_max: 20,
                parcelas_max: 72,
                ato_minimo: 750
            },
            MRV: {
                percentual_max: 23,
                parcelas_max: 60,
                sinal_minimo_perc: 1,
                sinal_parcelado: 5,
                usa_incc: true
            }
        };

        // BASE DE IM√ìVEIS (29 IM√ìVEIS DISPON√çVEIS)
        const BASE_IMOVEIS = [
            {id: 1, construtora: "TENDA", nome: "Quinta do Lago Maggiore", valor: 198000, cidade: "Porto Alegre", bairro: "Passo das Pedras", tipo: "Apartamento", quartos: 2, area: 50, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/quinta-do-lago-maggiore", obs: "MCMV | Zona Norte | Pr√≥x. Stock Center"},
            {id: 2, construtora: "TENDA", nome: "Ipanema Residence", valor: 235000, cidade: "Porto Alegre", bairro: "Ipanema", tipo: "Apartamento", quartos: 2, area: 55, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/ipanema-residence", obs: "MCMV | Zona Sul | Pr√≥x. Orla Gua√≠ba"},
            {id: 3, construtora: "TENDA", nome: "Parque Paris", valor: 205000, cidade: "Porto Alegre", bairro: "Santa Rosa de Lima", tipo: "Apartamento", quartos: 2, area: 52, status: "Lan√ßamento", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/parque-paris", obs: "MCMV | Zona Norte | Lan√ßamento 2025"},
            {id: 4, construtora: "TENDA", nome: "Am√©rica Residence", valor: 215000, cidade: "Porto Alegre", bairro: "Jardim Carvalho", tipo: "Apartamento", quartos: 2, area: 53, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/america-residence", obs: "MCMV | Zona Leste | Subs√≠dio at√© R$ 70k"},
            {id: 5, construtora: "TENDA", nome: "Quinta do Lago Carezza", valor: 192000, cidade: "Porto Alegre", bairro: "Passo das Pedras", tipo: "Apartamento", quartos: 2, area: 48, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/quinta-do-lago-carezza", obs: "MCMV | Zona Norte | Entrada facilitada"},
            {id: 6, construtora: "TENDA", nome: "Quinta do Lago Garda", valor: 195000, cidade: "Porto Alegre", bairro: "Passo das Pedras", tipo: "Apartamento", quartos: 2, area: 50, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/quinta-do-lago-garda", obs: "MCMV | Zona Norte | Condom√≠nio fechado"},
            {id: 7, construtora: "TENDA", nome: "Jardim Verde Ipanema", valor: 228000, cidade: "Porto Alegre", bairro: "Ipanema", tipo: "Apartamento", quartos: 2, area: 54, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/jardim-verde-ipanema", obs: "MCMV | Zona Sul | 100% vagas"},
            {id: 8, construtora: "TENDA", nome: "Morada do Campo II", valor: 185000, cidade: "Porto Alegre", bairro: "Campo Novo", tipo: "Apartamento", quartos: 2, area: 47, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/porto-alegre/morada-do-campo-ii", obs: "MCMV | Zona Sul | Melhor pre√ßo"},
            {id: 9, construtora: "TENDA", nome: "Recanto Cristal", valor: 238000, cidade: "Porto Alegre", bairro: "Zona Sul", tipo: "Apartamento", quartos: 2, area: 56, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/zona-sul", obs: "MCMV | Pr√≥x. BarraShopping Sul"},
            {id: 10, construtora: "TENDA", nome: "Residencial Canoas", valor: 178000, cidade: "Canoas", bairro: "Mato Grande", tipo: "Apartamento", quartos: 2, area: 48, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/canoas", obs: "MCMV | Regi√£o Metropolitana"},
            {id: 11, construtora: "TENDA", nome: "Residencial Cachoeirinha", valor: 175000, cidade: "Cachoeirinha", bairro: "Centro", tipo: "Apartamento", quartos: 2, area: 47, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/cachoeirinha", obs: "MCMV | Melhor entrada"},
            {id: 12, construtora: "MRV", nome: "Parque Porto Boa Vista", valor: 255000, cidade: "Porto Alegre", bairro: "Zona Norte", tipo: "Apartamento", quartos: 2, area: 55, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/zona-norte/parque-porto-boa-vista", obs: "MCMV | Elevador | Varanda churrasqueira"},
            {id: 13, construtora: "MRV", nome: "Porto Cambar√°", valor: 245000, cidade: "Porto Alegre", bairro: "Jardim Planalto", tipo: "Apartamento", quartos: 2, area: 53, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/reg-do-jardim-planalto/porto-cambara", obs: "MCMV | Sal√£o festas | Churrasqueira"},
            {id: 14, construtora: "MRV", nome: "Porto S√£o Miguel", valor: 262000, cidade: "Porto Alegre", bairro: "Parque Santa F√©", tipo: "Apartamento", quartos: 2, area: 57, status: "Lan√ßamento", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/parque-santa-fe/porto-sao-miguel", obs: "MCMV | Varanda gourmet | Pet place"},
            {id: 15, construtora: "MRV", nome: "Porto Hort√™nsias", valor: 258000, cidade: "Porto Alegre", bairro: "Anchieta", tipo: "Apartamento", quartos: 2, area: 56, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/regiao-de-anchieta/porto-hortensias", obs: "MCMV | Pr√≥x. Aeroporto | Energia solar"},
            {id: 16, construtora: "MRV", nome: "Porto das Miss√µes", valor: 248000, cidade: "Porto Alegre", bairro: "Vila Nova", tipo: "Apartamento", quartos: 2, area: 54, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/vila-nova/porto-das-missoes", obs: "MCMV | Zona Sul | Orla Ipanema"},
            {id: 17, construtora: "MRV", nome: "Porto Essenza", valor: 268000, cidade: "Porto Alegre", bairro: "Ecoville", tipo: "Apartamento", quartos: 2, area: 58, status: "Lan√ßamento", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/ecoville/porto-essenza", obs: "MCMV | Coworking | Academia premium"},
            {id: 18, construtora: "MRV", nome: "Porto Montenegro", valor: 275000, cidade: "Porto Alegre", bairro: "Jardim Planalto", tipo: "Apartamento", quartos: 2, area: 59, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/reg-do-jardim-planalto/residencial-porto-montenegro", obs: "Linha Class | Su√≠te | Bikes compartilhadas"},
            {id: 19, construtora: "MRV", nome: "Porto Montenegro 1D", valor: 188000, cidade: "Porto Alegre", bairro: "Jardim Planalto", tipo: "Apartamento", quartos: 1, area: 45, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/apartamentos/rio-grande-do-sul/porto-alegre/reg-do-jardim-planalto/residencial-porto-montenegro", obs: "MCMV | 1 dorm su√≠te | Lazer completo"},
            {id: 20, construtora: "MRV", nome: "Porto do Vale", valor: 242000, cidade: "Porto Alegre", bairro: "Sarandi", tipo: "Apartamento", quartos: 2, area: 52, status: "Dispon√≠vel", link: "https://www.mrv.com.br/imoveis/rio-grande-do-sul/porto-alegre", obs: "MCMV | Zona Norte | Pr√≥x. com√©rcio"},
            {id: 21, construtora: "VASCO", nome: "Villa Pienza", valor: 255000, cidade: "Porto Alegre", bairro: "Zona Sul", tipo: "Apartamento", quartos: 2, area: 55, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/imovel/apartamentos-a-venda-porto-alegre-rs-villa-pienza", obs: "MCMV | Piscinas | Academia ao ar livre"},
            {id: 22, construtora: "VASCO", nome: "Villa Pienza 1D", valor: 195000, cidade: "Porto Alegre", bairro: "Zona Sul", tipo: "Apartamento", quartos: 1, area: 42, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/imovel/apartamentos-a-venda-porto-alegre-rs-villa-pienza", obs: "MCMV | 1 dorm | Lazer completo"},
            {id: 23, construtora: "VASCO", nome: "Recanto dos Girass√≥is", valor: 198000, cidade: "Cachoeirinha", bairro: "Centro", tipo: "Casa", quartos: 2, area: 70, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/empreendimentos-interna/recanto-dos-girassois--24", obs: "MCMV | Casas | P√°tio privativo"},
            {id: 24, construtora: "VASCO", nome: "Parque do Mirante", valor: 215000, cidade: "Gravata√≠", bairro: "Centro", tipo: "Casa", quartos: 2, area: 65, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/imovel/casas-a-venda-gravatai-rs-parque-do-mirante", obs: "MCMV | Condom√≠nio | 1-3 quartos"},
            {id: 25, construtora: "VASCO", nome: "Parque do Mirante 3D", valor: 235000, cidade: "Gravata√≠", bairro: "Centro", tipo: "Casa", quartos: 3, area: 78, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/imovel/casas-a-venda-gravatai-rs-parque-do-mirante", obs: "MCMV | 3 quartos su√≠te | P√°tio"},
            {id: 26, construtora: "VASCO", nome: "Recanto do Bosque", valor: 205000, cidade: "Esteio", bairro: "Centro", tipo: "Casa", quartos: 2, area: 68, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/imovel/recanto-do-bosque", obs: "MCMV | Casas | P√°tio privativo"},
            {id: 27, construtora: "VASCO", nome: "Villa Bella", valor: 188000, cidade: "Cachoeirinha", bairro: "Centro", tipo: "Casa", quartos: 2, area: 65, status: "Dispon√≠vel", link: "https://construtoravasco.com.br/empreendimentos-interna/villa-bella-13", obs: "MCMV | Casas | Melhor custo-benef√≠cio"},
            {id: 28, construtora: "VASCO", nome: "Jardim das Ac√°cias", valor: 208000, cidade: "Gravata√≠", bairro: "Morada do Vale", tipo: "Casa", quartos: 2, area: 67, status: "Lan√ßamento", link: "https://construtoravasco.com.br/imoveis", obs: "MCMV | Lan√ßamento | Casas t√©rreas"},
            {id: 29, construtora: "TENDA", nome: "Residencial Novo Hamburgo", valor: 182000, cidade: "Novo Hamburgo", bairro: "Centro", tipo: "Apartamento", quartos: 2, area: 49, status: "Dispon√≠vel", link: "https://tenda.com/apartamentos-a-venda/rs/novo-hamburgo", obs: "MCMV | Facilidade transporte"}
        ];

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function updateAvaliacao() {
            const valor = document.getElementById('avaliacao').value;
            document.getElementById('avaliacaoValor').textContent = formatarMoeda(parseInt(valor));
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 0 });
        }

        function salvarConfiguracoes() {
            config.tenda.ato_minimo = parseFloat(document.getElementById('configTendaAto').value);
            config.mrv.incc_mensal = parseFloat(document.getElementById('configMrvIncc').value);
            config.match.limite_recomendado = parseFloat(document.getElementById('configLimiteRecomendado').value);
            config.match.limite_possivel = parseFloat(document.getElementById('configLimitePossivel').value);

            localStorage.setItem('config', JSON.stringify(config));

            alert('‚úÖ Configura√ß√µes salvas com sucesso!\n\nOs c√°lculos agora usar√£o os novos valores.');
        }

        function calcularSubsidio(renda, temFatorSocial, faixa) {
            let subsidioBase = 0;

            if (faixa === 1) {
                if (renda <= 2000) {
                    let fatorBaixaRenda = (2000 - renda) / 2000;
                    subsidioBase = 12000 + (fatorBaixaRenda * 43000);
                } else if (renda <= 2350) {
                    let posicao = (renda - 2000) / (2350 - 2000);
                    subsidioBase = 12000 - (posicao * 4455);
                } else if (renda <= 2850) {
                    let posicao = (renda - 2350) / (2850 - 2350);
                    subsidioBase = 7545 - (posicao * 6945);
                }
            } else if (faixa === 2) {
                if (renda <= 4000) {
                    subsidioBase = 600;
                } else {
                    let posicao = (renda - 4000) / (4700 - 4000);
                    subsidioBase = 600 - (posicao * 600);
                }
            }

            if (temFatorSocial) {
                subsidioBase = subsidioBase * 3.32;
            }

            return Math.round(subsidioBase);
        }

        function calcularCoeficiente(taxa, prazo) {
            const taxaMensal = taxa / 100 / 12;
            const fator = Math.pow(1 + taxaMensal, prazo);
            const coeficiente = (taxaMensal * fator) / (fator - 1);
            return coeficiente * 1000;
        }

        function calcular() {
            const nome = document.getElementById('nomeCliente').value;
            const renda = parseFloat(document.getElementById('renda').value);
            const vinculo = document.getElementById('vinculo').value;
            const avaliacao = parseFloat(document.getElementById('avaliacao').value);
            const fgts = parseFloat(document.getElementById('fgts').value) || 0;
            const fatorSocial = document.getElementById('fatorSocial').value === 'sim';

            if (!nome || !renda) {
                alert('Preencha o nome e a renda!');
                return;
            }

            // Determinar faixa e fator v√≠nculo
            let faixa = renda <= 2850 ? 1 : 2;
            let fatorVinculo = vinculo === 'clt' ? 1.0 : (vinculo === 'autonomo' ? 0.8 : 0.9);
            
            const rendaConsiderada = renda * fatorVinculo;
            const taxa = 4.5;
            const prazo = 420;

            // Calcular parcela m√°xima
            const parcelaMaximaBruta = rendaConsiderada * 0.30;
            const parcelaParaFinanciamento = parcelaMaximaBruta * 0.954;
            const parcelaMaxima = parcelaMaximaBruta;

            // Calcular coeficiente e valor financi√°vel
            const coeficiente = calcularCoeficiente(taxa, prazo);
            const valorFinanciavel = (parcelaParaFinanciamento / coeficiente) * 1000;
            const limiteAvaliacao = avaliacao * 0.80;
            const valorFinanciado = Math.min(valorFinanciavel, limiteAvaliacao);

            // Calcular subs√≠dio
            const subsidio = calcularSubsidio(renda, fatorSocial, faixa);

            // Calcular entrada
            let entrada = avaliacao - valorFinanciado - subsidio - fgts;
            if (entrada < 0) entrada = 0;

            // Capacidade total
            capacidadeCliente = avaliacao;

            // Armazenar dados
            dadosSimulacao = {
                nome,
                renda,
                avaliacao,
                faixa: faixa === 1 ? 'Faixa 1' : 'Faixa 2',
                valorFinanciado,
                subsidio,
                entrada,
                fgts,
                parcela: parcelaMaxima,
                taxa
            };

            // Mostrar resultados
            mostrarResultados();

            // Carregar im√≥veis
            carregarImoveis();

            // Ir para aba de im√≥veis
            document.querySelectorAll('.tab')[2].click();
        }

        function mostrarResultados() {
            const html = `
                <div class="result-box">
                    <div class="result-header">üí∞ CAPACIDADE TOTAL DE COMPRA</div>
                    <div class="result-value">${formatarMoeda(dadosSimulacao.avaliacao)}</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                            <div style="color: #666; font-size: 14px;">Financiamento</div>
                            <div style="color: #667eea; font-size: 20px; font-weight: bold;">${formatarMoeda(dadosSimulacao.valorFinanciado)}</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                            <div style="color: #666; font-size: 14px;">Subs√≠dio</div>
                            <div style="color: #28a745; font-size: 20px; font-weight: bold;">${formatarMoeda(dadosSimulacao.subsidio)}</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                            <div style="color: #666; font-size: 14px;">Entrada</div>
                            <div style="color: #333; font-size: 20px; font-weight: bold;">${formatarMoeda(dadosSimulacao.entrada)}</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                            <div style="color: #666; font-size: 14px;">Parcela MCMV</div>
                            <div style="color: #667eea; font-size: 20px; font-weight: bold;">${formatarMoeda(dadosSimulacao.parcela)}</div>
                        </div>
                    </div>
                </div>
            `;
            
            const div = document.getElementById('resultados');
            div.innerHTML = html;
            div.style.display = 'block';
        }

        function carregarImoveis() {
            const loading = document.getElementById('imoveisLoading');
            const grid = document.getElementById('imoveisGrid');
            
            loading.innerHTML = '‚è≥ Calculando viabilidade para cada im√≥vel...';
            loading.style.display = 'block';
            grid.style.display = 'none';

            // Carregar im√≥veis da base fixa
            todosImoveis = [...BASE_IMOVEIS];

            // Mostrar sucesso
            loading.innerHTML = `<div class="success-message">‚úÖ ${todosImoveis.length} im√≥veis carregados! Calculando viabilidade...</div>`;

            // Calcular viabilidade para cada im√≥vel
            calcularViabilidades();
            
            // Mostrar im√≥veis
            aplicarFiltros();
            
            setTimeout(() => {
                loading.style.display = 'none';
                grid.style.display = 'grid';
                document.getElementById('filters').style.display = 'grid';
                document.getElementById('statsBar').style.display = 'flex';
            }, 1000);
        }

        function calcularViabilidades() {
            todosImoveis.forEach(imovel => {
                const entrada = Math.max(0, imovel.valor - dadosSimulacao.valorFinanciado - dadosSimulacao.subsidio - dadosSimulacao.fgts);
                
                imovel.entrada = entrada;
                imovel.viabilidade = calcularViabilidadeConstrutora(imovel, entrada);
                
                // Ordenar por score de viabilidade
                imovel.score = imovel.viabilidade.tipo === 'recomendado' ? 1 : 
                              (imovel.viabilidade.tipo === 'possivel' ? 2 : 3);
            });

            // Ordenar: Recomendado > Poss√≠vel > N√£o Recomendado > Menor pre√ßo
            todosImoveis.sort((a, b) => {
                if (a.score !== b.score) return a.score - b.score;
                return a.valor - b.valor;
            });
        }

        function calcularViabilidadeConstrutora(imovel, entrada) {
            const construtora = imovel.construtora;
            const regras = REGRAS_CONSTRUTORAS[construtora];
            
            if (construtora === 'VASCO') {
                return calcularViabilidadeVasco(imovel, entrada, regras);
            } else if (construtora === 'TENDA') {
                return calcularViabilidadeTenda(imovel, entrada, regras);
            } else if (construtora === 'MRV') {
                return calcularViabilidadeMRV(imovel, entrada, regras);
            }
        }

        function calcularViabilidadeVasco(imovel, entrada, regras) {
            const entradaMax = imovel.valor * (regras.percentual_max / 100);
            const ato = regras.ato_minimo;

            if (entrada > entradaMax) {
                return {
                    tipo: 'nao-recomendado',
                    motivo: `Entrada necess√°ria (${formatarMoeda(entrada)}) excede limite VASCO de 20% do im√≥vel (${formatarMoeda(entradaMax)})`,
                    detalhes: null
                };
            }

            const opcoes = [];
            
            // Calcular op√ß√µes de parcelamento: 90x, 60x, 36x
            for (let parcelas of [90, 60, 36]) {
                const parcelaMensal = entrada / parcelas;
                const totalMensal = dadosSimulacao.parcela + parcelaMensal;
                const comprometimento = (totalMensal / dadosSimulacao.renda) * 100;
                
                opcoes.push({
                    parcelas,
                    parcelaMensal,
                    totalMensal,
                    comprometimento
                });
            }

            const melhorOpcao = opcoes[0]; // 90x tem menor parcela
            const tipo = melhorOpcao.comprometimento <= config.match.limite_recomendado ? 'recomendado' : 
                        (melhorOpcao.comprometimento <= config.match.limite_possivel ? 'possivel' : 'nao-recomendado');
            
            return {
                tipo,
                motivo: tipo === 'recomendado' ? 
                    `Cliente possui margem confort√°vel (${melhorOpcao.comprometimento.toFixed(1)}% da renda)` :
                    tipo === 'possivel' ?
                    `Cliente consegue pagar mas com comprometimento moderado (${melhorOpcao.comprometimento.toFixed(1)}%)` :
                    `Comprometimento muito alto (${melhorOpcao.comprometimento.toFixed(1)}%)`,
                detalhes: {
                    ato,
                    opcoes,
                    melhorOpcao
                }
            };
        }

        function calcularViabilidadeTenda(imovel, entrada, regras) {
            const entradaMax = imovel.valor * (regras.percentual_max / 100);
            const ato = config.tenda.ato_minimo;
            const saldoEntrada = Math.max(0, entrada - ato);
            const parcelasMax = regras.parcelas_max;

            if (entrada > entradaMax) {
                return {
                    tipo: 'nao-recomendado',
                    motivo: `Entrada necess√°ria (${formatarMoeda(entrada)}) excede limite TENDA de 20% do im√≥vel (${formatarMoeda(entradaMax)})`,
                    detalhes: null
                };
            }

            const opcoes = [];
            
            // Calcular op√ß√µes de parcelamento
            for (let parcelas of [72, 60, 48, 36]) {
                const parcelaMensal = saldoEntrada / parcelas;
                const totalMensal = dadosSimulacao.parcela + parcelaMensal;
                const comprometimento = (totalMensal / dadosSimulacao.renda) * 100;
                
                opcoes.push({
                    parcelas,
                    parcelaMensal,
                    totalMensal,
                    comprometimento
                });
            }

            const melhorOpcao = opcoes[0]; // Menor parcela = mais parcelas
            const tipo = melhorOpcao.comprometimento <= config.match.limite_recomendado ? 'recomendado' : 
                        (melhorOpcao.comprometimento <= config.match.limite_possivel ? 'possivel' : 'nao-recomendado');
            
            return {
                tipo,
                motivo: tipo === 'recomendado' ? 
                    `Cliente possui margem confort√°vel (${melhorOpcao.comprometimento.toFixed(1)}% da renda)` :
                    tipo === 'possivel' ?
                    `Cliente consegue pagar mas com comprometimento moderado (${melhorOpcao.comprometimento.toFixed(1)}%)` :
                    `Comprometimento muito alto (${melhorOpcao.comprometimento.toFixed(1)}%)`,
                detalhes: {
                    ato,
                    saldoEntrada,
                    opcoes,
                    melhorOpcao
                }
            };
        }

        function calcularViabilidadeMRV(imovel, entrada, regras) {
            const entradaMax = imovel.valor * (regras.percentual_max / 100);
            const sinalMinimo = imovel.valor * (regras.sinal_minimo_perc / 100);
            const sinalParcelado = sinalMinimo / regras.sinal_parcelado;
            const saldoEntrada = Math.max(0, entrada - sinalMinimo);
            
            if (entrada > entradaMax) {
                return {
                    tipo: 'nao-recomendado',
                    motivo: `Entrada necess√°ria (${formatarMoeda(entrada)}) excede limite MRV de 23% do im√≥vel (${formatarMoeda(entradaMax)})`,
                    detalhes: null
                };
            }

            // Calcular com INCC
            const inccMensal = config.mrv.incc_mensal / 100;
            const parcelas = regras.parcelas_max;
            
            // Calcular parcela m√©dia considerando INCC
            const parcelaBase = saldoEntrada / parcelas;
            const fatorINCCMedio = Math.pow(1 + inccMensal, parcelas / 2); // INCC m√©dio do per√≠odo
            const parcelaMensalMedia = parcelaBase * fatorINCCMedio;
            
            const totalMensal = dadosSimulacao.parcela + parcelaMensalMedia;
            const comprometimento = (totalMensal / dadosSimulacao.renda) * 100;

            const tipo = comprometimento <= config.match.limite_recomendado ? 'recomendado' : 
                        (comprometimento <= config.match.limite_possivel ? 'possivel' : 'nao-recomendado');
            
            return {
                tipo,
                motivo: tipo === 'recomendado' ? 
                    `Cliente possui margem confort√°vel (${comprometimento.toFixed(1)}% da renda)` :
                    tipo === 'possivel' ?
                    `Cliente consegue pagar mas com comprometimento moderado (${comprometimento.toFixed(1)}%)` :
                    `Comprometimento muito alto (${comprometimento.toFixed(1)}%)`,
                detalhes: {
                    sinalMinimo,
                    sinalParcelado,
                    saldoEntrada,
                    parcelas,
                    parcelaBase,
                    parcelaMensalMedia,
                    inccMensal: config.mrv.incc_mensal,
                    totalMensal,
                    comprometimento
                }
            };
        }

        function aplicarFiltros() {
            const filterConst = document.getElementById('filterConstrutora').value;
            const filterTipo = document.getElementById('filterTipo').value;
            const filterQuartos = document.getElementById('filterQuartos').value;
            const filterViabilidade = document.getElementById('filterViabilidade').value;

            imoveisFiltrados = todosImoveis.filter(imovel => {
                if (filterConst && imovel.construtora !== filterConst) return false;
                if (filterTipo && imovel.tipo !== filterTipo) return false;
                if (filterQuartos && imovel.quartos != filterQuartos) return false;
                if (filterViabilidade && imovel.viabilidade.tipo !== filterViabilidade) return false;
                return true;
            });

            mostrarImoveis();
            atualizarStats();
        }

        function gerarMensagemWhatsApp(imovel) {
            let msg = `üè† *${dadosSimulacao.nome}*, encontrei um im√≥vel para voc√™!

üìç *${imovel.nome}*
üè¢ Construtora: ${imovel.construtora}
üí∞ Valor: ${formatarMoeda(imovel.valor)}
üìç Localiza√ß√£o: ${imovel.cidade} - ${imovel.bairro}
üè† Tipo: ${imovel.tipo}
üõèÔ∏è Quartos: ${imovel.quartos}
üìè √Årea: ${imovel.area}m¬≤

üíµ *SEU FINANCIAMENTO:*
‚úÖ Valor Financiado: ${formatarMoeda(dadosSimulacao.valorFinanciado)}
‚úÖ Subs√≠dio MCMV: ${formatarMoeda(dadosSimulacao.subsidio)}
‚úÖ FGTS: ${formatarMoeda(dadosSimulacao.fgts)}
‚úÖ Entrada: ${formatarMoeda(imovel.entrada)}
üí≥ Parcela MCMV: ${formatarMoeda(dadosSimulacao.parcela)}/m√™s

`;

            // Adicionar detalhes da construtora
            if (imovel.viabilidade.detalhes) {
                if (imovel.construtora === 'VASCO' && imovel.viabilidade.detalhes.melhorOpcao) {
                    const op = imovel.viabilidade.detalhes.melhorOpcao;
                    msg += `üìÖ *ENTRADA PARCELADA (${imovel.construtora}):*
${op.parcelas}x de ${formatarMoeda(op.parcelaMensal)}
üí≥ Total mensal: ${formatarMoeda(op.totalMensal)}

`;
                } else if (imovel.construtora === 'TENDA' && imovel.viabilidade.detalhes.melhorOpcao) {
                    const op = imovel.viabilidade.detalhes.melhorOpcao;
                    msg += `üìÖ *ENTRADA PARCELADA (${imovel.construtora}):*
üí∏ Ato √† vista: ${formatarMoeda(imovel.viabilidade.detalhes.ato)}
üìÖ Fluxo: ${op.parcelas}x de ${formatarMoeda(op.parcelaMensal)}
üí≥ Total mensal: ${formatarMoeda(op.totalMensal)}

`;
                } else if (imovel.construtora === 'MRV' && imovel.viabilidade.detalhes) {
                    const det = imovel.viabilidade.detalhes;
                    msg += `üìÖ *ENTRADA PARCELADA (${imovel.construtora}):*
üí∏ Sinal 1%: ${formatarMoeda(det.sinalMinimo)}
üìÖ Fluxo: ${det.parcelas}x m√©dia ${formatarMoeda(det.parcelaMensalMedia)} (com INCC)
üí≥ Total mensal: ${formatarMoeda(det.totalMensal)}

`;
                }
            }

            msg += `üîó Mais detalhes: ${imovel.link}

Quer agendar uma visita? üóìÔ∏è`;

            return encodeURIComponent(msg);
        }

        function mostrarImoveis() {
            const grid = document.getElementById('imoveisGrid');
            
            if (imoveisFiltrados.length === 0) {
                grid.innerHTML = '<div class="loading">üòî Nenhum im√≥vel encontrado com esses filtros</div>';
                return;
            }

            let html = '';
            
            imoveisFiltrados.forEach(imovel => {
                const badgeConst = imovel.construtora === 'TENDA' ? 'badge-tenda' : 
                                  (imovel.construtora === 'MRV' ? 'badge-mrv' : 'badge-vasco');
                
                const matchBadge = imovel.viabilidade.tipo === 'recomendado' ? 'badge-recomendado' :
                                  (imovel.viabilidade.tipo === 'possivel' ? 'badge-possivel' : 'badge-nao-recomendado');
                
                const matchClass = 'match-' + imovel.viabilidade.tipo;
                const viabClass = 'viabilidade-' + imovel.viabilidade.tipo;
                
                const matchLabel = imovel.viabilidade.tipo === 'recomendado' ? '‚úÖ RECOMENDADO' :
                                  (imovel.viabilidade.tipo === 'possivel' ? '‚ö†Ô∏è POSS√çVEL' : '‚ùå N√ÉO RECOMENDADO');
                
                const whatsappMsg = gerarMensagemWhatsApp(imovel);
                const whatsappLink = `https://wa.me/?text=${whatsappMsg}`;
                
                // Resumo MCMV (sempre mostra)
                let resumoMCMV = '<div class="entrada-detalhes" style="background: #e8f4f8; border-left: 4px solid #667eea;">';
                resumoMCMV += '<h4>üí∞ RESUMO FINANCIAMENTO MCMV</h4>';
                resumoMCMV += `<div class="entrada-linha"><span>Valor Financiado:</span><span>${formatarMoeda(dadosSimulacao.valorFinanciado)}</span></div>`;
                resumoMCMV += `<div class="entrada-linha"><span>Subs√≠dio MCMV:</span><span>${formatarMoeda(dadosSimulacao.subsidio)}</span></div>`;
                resumoMCMV += `<div class="entrada-linha"><span>FGTS:</span><span>${formatarMoeda(dadosSimulacao.fgts)}</span></div>`;
                resumoMCMV += `<div class="entrada-linha"><span>Entrada Total:</span><span>${formatarMoeda(imovel.entrada)}</span></div>`;
                resumoMCMV += `<div class="entrada-linha destaque"><span>Parcela MCMV:</span><span>${formatarMoeda(dadosSimulacao.parcela)}/m√™s</span></div>`;
                resumoMCMV += '</div>';
                
                let detalhesHTML = '';
                
                if (imovel.viabilidade.detalhes) {
                    detalhesHTML = '<div class="entrada-detalhes">';
                    detalhesHTML += `<h4>üìÖ ENTRADA PARCELADA (${imovel.construtora})</h4>`;
                    
                    if (imovel.construtora === 'VASCO') {
                        const det = imovel.viabilidade.detalhes;
                        detalhesHTML += `<div class="entrada-linha"><span>Entrada at√© 20% do im√≥vel (${formatarMoeda(imovel.valor * 0.2)})</span></div>`;
                        detalhesHTML += `<div class="entrada-linha"><span>Entrada necess√°ria:</span><span>${formatarMoeda(imovel.entrada)}</span></div>`;
                        
                        if (det.melhorOpcao) {
                            detalhesHTML += '<br><strong>Op√ß√µes de parcelamento:</strong>';
                            det.opcoes.forEach(op => {
                                detalhesHTML += `<div class="entrada-linha"><span>${op.parcelas}x:</span><span>${formatarMoeda(op.parcelaMensal)}/m√™s (total: ${formatarMoeda(op.totalMensal)})</span></div>`;
                            });
                        }
                    } else if (imovel.construtora === 'TENDA') {
                        const det = imovel.viabilidade.detalhes;
                        detalhesHTML += `<div class="entrada-linha"><span>Ato √† vista:</span><span>${formatarMoeda(det.ato)}</span></div>`;
                        detalhesHTML += `<div class="entrada-linha"><span>Saldo a parcelar:</span><span>${formatarMoeda(det.saldoEntrada)}</span></div>`;
                        
                        if (det.melhorOpcao) {
                            detalhesHTML += '<br><strong>Op√ß√µes de parcelamento:</strong>';
                            det.opcoes.forEach(op => {
                                detalhesHTML += `<div class="entrada-linha"><span>${op.parcelas}x:</span><span>${formatarMoeda(op.parcelaMensal)}/m√™s (total: ${formatarMoeda(op.totalMensal)})</span></div>`;
                            });
                        }
                    } else if (imovel.construtora === 'MRV') {
                        const det = imovel.viabilidade.detalhes;
                        detalhesHTML += `<div class="entrada-linha"><span>Sinal 1%:</span><span>${formatarMoeda(det.sinalMinimo)}</span></div>`;
                        detalhesHTML += `<div class="entrada-linha"><span>Ou 5x de:</span><span>${formatarMoeda(det.sinalParcelado)}/m√™s</span></div>`;
                        detalhesHTML += `<div class="entrada-linha"><span>Saldo a parcelar:</span><span>${formatarMoeda(det.saldoEntrada)}</span></div>`;
                        detalhesHTML += '<br><strong>Fluxo com INCC:</strong>';
                        detalhesHTML += `<div class="entrada-linha"><span>${det.parcelas}x (m√©dia):</span><span>${formatarMoeda(det.parcelaMensalMedia)}/m√™s</span></div>`;
                        detalhesHTML += `<div class="entrada-linha"><span>INCC estimado:</span><span>${det.inccMensal}% ao m√™s</span></div>`;
                        detalhesHTML += `<div class="entrada-linha destaque"><span>Total mensal:</span><span>${formatarMoeda(det.totalMensal)}</span></div>`;
                    }
                    
                    detalhesHTML += '</div>';
                }
                
                html += `
                    <div class="imovel-card ${matchClass}">
                        <div>
                            <span class="match-badge ${matchBadge}">${matchLabel}</span>
                            <span class="construtora-badge ${badgeConst}">${imovel.construtora}</span>
                        </div>
                        <div class="imovel-nome">${imovel.nome}</div>
                        <div class="imovel-preco">${formatarMoeda(imovel.valor)}</div>
                        <div class="imovel-info">
                            <span class="info-tag">üìç ${imovel.cidade} - ${imovel.bairro}</span>
                            <span class="info-tag">üè† ${imovel.tipo}</span>
                            <span class="info-tag">üõèÔ∏è ${imovel.quartos}Q</span>
                            <span class="info-tag">üìè ${imovel.area}m¬≤</span>
                        </div>
                        ${resumoMCMV}
                        ${detalhesHTML}
                        <div class="viabilidade-box ${viabClass}">
                            ${imovel.viabilidade.motivo}
                        </div>
                        <div style="text-align: center; margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                            <a href="${imovel.link}" target="_blank" class="btn btn-secondary" style="text-decoration: none; flex: 1;">
                                üîó Ver Detalhes
                            </a>
                            ${imovel.viabilidade.tipo !== 'nao-recomendado' ? 
                                `<a href="${whatsappLink}" target="_blank" class="btn btn-success" style="text-decoration: none; flex: 1;">
                                    üì± WhatsApp
                                </a>` : ''}
                        </div>
                        <div class="imovel-obs">${imovel.obs}</div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }

        function atualizarStats() {
            const total = imoveisFiltrados.length;
            const recomendado = imoveisFiltrados.filter(i => i.viabilidade.tipo === 'recomendado').length;
            const possivel = imoveisFiltrados.filter(i => i.viabilidade.tipo === 'possivel').length;
            const naoRecomendado = imoveisFiltrados.filter(i => i.viabilidade.tipo === 'nao-recomendado').length;

            document.getElementById('statTotal').textContent = total;
            document.getElementById('statRecomendado').textContent = recomendado;
            document.getElementById('statPossivel').textContent = possivel;
            document.getElementById('statNaoRecomendado').textContent = naoRecomendado;
        }

        // Carregar configura√ß√µes salvas do localStorage (se existirem)
        window.onload = function() {
            if (localStorage.getItem('config')) {
                const savedConfig = JSON.parse(localStorage.getItem('config'));
                config = savedConfig;
                
                document.getElementById('configTendaAto').value = config.tenda.ato_minimo;
                document.getElementById('configMrvIncc').value = config.mrv.incc_mensal;
                document.getElementById('configLimiteRecomendado').value = config.match.limite_recomendado;
                document.getElementById('configLimitePossivel').value = config.match.limite_possivel;
            }
        };
    </script>
</body>
</html>
